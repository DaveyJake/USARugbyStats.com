<?php
use UsaRugbyStats\Competition\Entity\Team;

$isRelative = $this->relativeToTeam instanceof Team;
$now = new DateTime();
?>
<table class="responsive">
	<thead class="header">
		<th class="date">Date</th>
		<th class="opponent">Opponent</th>
		<th class="result-time">Result/Time</th>
		<th class="location">Location</th>
		<th class="type">Type</th>
	</thead>
	<?php foreach ( $this->matches as $match ): ?>
    <?php   $matchUrl = $this->url('usarugbystats_frontend_competition_match/view', ['cid' => $match->getCompetition()->getId(), 'mid' => $match->getId()]); ?>
    <?php   $matchEditUrl = $this->url('usarugbystats_frontend_competition_match/update', ['cid' => $match->getCompetition()->getId(), 'mid' => $match->getId()]); ?>
    <?php   $compUrl  = $this->url('usarugbystats_frontend_competition', ['id' => $match->getCompetition()->getId()]); ?>
	<tr>
		<td class="date"><a href="<?=$this->escapeHtmlAttr($matchUrl); ?>"><?=$this->escapeHtml($match->getDate()->format('M jS')); ?></a></td>
		<td class="opponent">
		<?php if ( $isRelative ): ?>
		<?php   $opponent = $match->getTeam('H')->getTeam()->getId() == $this->relativeToTeam->getId()
		                  ? $match->getTeam('A')
		                  : $match->getTeam('H');
		?>

		v. <img src="<?php echo $this->escapeHtmlAttr($this->ursTeamLogoUrl($opponent)); ?>"><?php echo $this->ursTeamLink($opponent); ?>
		<?php endif;?>
		</td>
		<td class="result-time">
		<?php if ( $now <= $match->getDate() ): ?>
		  <?=$this->escapeHtml($match->getDate()->format('H:i'));?>
		<?php elseif ( $isRelative ): ?>
		<?php   $teamSide = $match->getTeam('H')->getTeam()->getId() == $this->relativeToTeam->getId() ? 'H' : 'A'; ?>
		<?php   $opponentSide = $teamSide == 'H' ? 'A' : 'H'; ?>
		  <span><?=$this->escapeHtml($match->getWinningSide() == 'D' ? 'D' : ( $match->getWinningSide() == $teamSide ? 'W' : 'L')); ?></span>
		  <?=$this->escapeHtml($match->getTeam($teamSide)->getScore()); ?> -
		  <?=$this->escapeHtml($match->getTeam($opponentSide)->getScore()); ?>
		<?php endif; ?>
		</td>
		<td class="location">
        <?php if ( $match->getLocation() != null ): ?>
          <?php echo  $match->getLocation() ? $this->ursLocationLink($match->getLocation()) : ''; ?>
          <?php if ( $match->getLocation() && !empty($match->getLocationDetails()) ): ?>
            &nbsp;&dash;&nbsp;
          <?php endif; ?>
        <?php endif; ?>
        <?= $this->escapeHtml($match->getLocationDetails()); ?>
		</td>
		<td class="type"><?=$this->escapeHtml($match->getCompetition()->getTypeString());?></td>
	</tr>
	<?php endforeach; ?>
</table>

